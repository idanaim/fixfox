version: 1.0
runtime: nodejs18
build:
  commands:
    build:
      - echo "Installing dependencies..."
      - npm ci
      - echo "Building application..."
      - NX_CLOUD_DISTRIBUTED_EXECUTION=false npx nx build rest-man-server --skip-nx-cache
      - echo "Preparing deployment..."
      - mkdir -p deployment
      - cp -r dist/apps/rest-man-server/* deployment/
      - cp package.json deployment/
      - cp package-lock.json deployment/
      - cd deployment && npm ci --production
run:
  runtime-version: nodejs18
  command: npm start
  network:
    port: 3000
    env: PORT
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "3000"
    - name: OPENAI_API_KEY
      value: "dummy-key-for-production" 